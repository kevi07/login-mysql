<!DOCTYPE html>
<html lang="en">
<head>
    <%- include('partials/header') %>
    <link rel="stylesheet" href="./loginstyle.css">
</head>
<body>
    <section>
        <div class="container">
            <form action="/auth/login" method="POST">
                <h3>Login</h3><br>
                <input type="email" name="email" id="email" placeholder="Email">
                <div class="emailerr"></div>
                <input type="password" name="password" id="password" placeholder="Password">
                <div class="passworderr"></div>
                <a href="">Forget password?</a><br><br>
                <button class="log-btn">Login</button>
                <br>
            </form>
        </div>
    </section>

    <script>
        const form = document.querySelector('form');
        const emailError = document.querySelector('.emailerr');
        const passwordError = document.querySelector('.passworderr');
        
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = form.email.value;
            const password = form.password.value;
          
            emailError.textContent = '';
            passwordError.textContent = '';
            try{
          const res = await fetch('/auth/login',{
            method:'POST',
            headers:{
              'Content-Type' : 'application/json'
            },
            body:JSON.stringify({email,password})
          }

          );

          const data = await res.json();
         
          
          if (data.errors) {
                emailError.textContent = data.errors.email || '';
                passwordError.textContent = data.errors.password || '';
            } else if (data.redirect) {
                window.location.href = data.redirect;
            } else if (data.message) {
                emailError.textContent = data.message;
            }
          }
          catch(err){
            console.log(err);
          }
        
        })
    </script>
</body>
</html>